const PicksService=function(){"use strict";const s=`${window.GBSV_CONFIG?.FUNCTIONS_URL||window.APP_CONFIG?.FUNCTIONS_BASE_URL||(window.APP_CONFIG?.API_BASE_URL?window.APP_CONFIG.API_BASE_URL.replace(/\/api$/,""):"")||window.APP_CONFIG?.API_BASE_FALLBACK||window.location.origin}/api/picks`;let n=null,h=null;const c=3e4;async function u(t,e={}){const r=t.startsWith("http")?t:`${s}${t}`,i={method:e.method||"GET",headers:{"Content-Type":"application/json",...e.headers},...e};e.body&&typeof e.body=="object"&&(i.body=JSON.stringify(e.body));try{const o=await fetch(r,i),l=await o.json();if(!o.ok)throw new Error(l.error||`API error: ${o.status}`);return l}catch(o){throw console.error("[PicksService] API request failed:",o),o}}function f(){n=null,h=null}async function m(t={}){const e=new URLSearchParams;Object.entries(t).forEach(([i,o])=>{o!=null&&o!==""&&e.append(i,o)});const r=e.toString()?`?${e}`:"";try{return(await u(r)).picks||[]}catch(i){return console.error("[PicksService] Failed to get picks:",i),[]}}async function g(){try{return(await u("/active")).picks||[]}catch(t){return console.error("[PicksService] Failed to get active picks:",t),[]}}async function b(){try{return(await u("/settled")).picks||[]}catch(t){return console.error("[PicksService] Failed to get settled picks:",t),[]}}async function L(t){try{return(await u(`/${t}`)).pick||null}catch(e){if(e.message.includes("404"))return null;throw e}}async function $(t){return m({league:t.toUpperCase()})}async function v(t){return m({date:t})}async function A(t,e){return m({from:t,to:e})}async function k(){const t=new Date().toISOString().split("T")[0];return v(t)}async function S(t){f();const e=Array.isArray(t)?t:[t];try{const r=await u("",{method:"POST",body:e});return window.dispatchEvent(new CustomEvent("picksUpdated",{detail:{action:"create",count:r.created||e.length}})),r}catch(r){throw console.error("[PicksService] Failed to create picks:",r),r}}async function y(t,e){f();try{const r=await u(`/${t}`,{method:"PATCH",body:e});return window.dispatchEvent(new CustomEvent("picksUpdated",{detail:{action:"update",id:t}})),r.pick}catch(r){throw console.error("[PicksService] Failed to update pick:",r),r}}async function C(t,e,r={}){return y(t,{status:e,...r})}async function E(t,e=0){return y(t,{status:"won",result:"WIN",pnl:e})}async function x(t,e=0){return y(t,{status:"lost",result:"LOSS",pnl:-Math.abs(e)})}async function N(t){return y(t,{status:"push",result:"PUSH",pnl:0})}async function P(t){f();try{return await u(`/${t}`,{method:"DELETE"}),window.dispatchEvent(new CustomEvent("picksUpdated",{detail:{action:"delete",id:t}})),!0}catch(e){throw console.error("[PicksService] Failed to delete pick:",e),e}}async function D(t=!1){if(!t)throw new Error("Must pass confirm=true to clear all picks");f();try{const e=await u("/clear",{method:"DELETE",headers:{"x-confirm-clear":"true"}});return window.dispatchEvent(new CustomEvent("picksUpdated",{detail:{action:"clearAll",deleted:e.deleted}})),e}catch(e){throw console.error("[PicksService] Failed to clear picks:",e),e}}async function I(t=null){t||(t=await m());const e={total:t.length,pending:0,live:0,won:0,lost:0,push:0,totalRisk:0,totalPnl:0,byLeague:{}};return t.forEach(r=>{const i=(r.status||"pending").toLowerCase();i==="pending"?e.pending++:i==="live"||i==="on-track"||i==="at-risk"?e.live++:i==="won"||i==="win"?e.won++:i==="lost"||i==="loss"?e.lost++:i==="push"&&e.push++,e.totalRisk+=parseFloat(r.risk)||0,e.totalPnl+=parseFloat(r.pnl)||0;const o=r.league||"Unknown";e.byLeague[o]||(e.byLeague[o]={total:0,won:0,lost:0,pnl:0}),e.byLeague[o].total++,(i==="won"||i==="win")&&e.byLeague[o].won++,(i==="lost"||i==="loss")&&e.byLeague[o].lost++,e.byLeague[o].pnl+=parseFloat(r.pnl)||0}),e.winRate=e.won+e.lost>0?(e.won/(e.won+e.lost)*100).toFixed(1)+"%":"N/A",e}async function T(){const t="gbsv_picks";try{const e=localStorage.getItem(t);if(!e)return{success:!0,migrated:0,message:"No local picks to migrate"};const r=JSON.parse(e);if(!Array.isArray(r)||r.length===0)return{success:!0,migrated:0,message:"No local picks to migrate"};console.log(`[PicksService] Migrating ${r.length} picks from localStorage to Azure...`);const i=await S(r);return i.success?(localStorage.setItem(`${t}_backup_${Date.now()}`,e),localStorage.removeItem(t),console.log(`[PicksService] Migration complete: ${i.created} picks migrated`),{success:!0,migrated:i.created,errors:i.errors,message:`Successfully migrated ${i.created} picks to Azure`}):{success:!1,migrated:0,error:"Migration failed"}}catch(e){return console.error("[PicksService] Migration failed:",e),{success:!1,migrated:0,error:e.message}}}function a(){const t="gbsv_picks";try{const e=localStorage.getItem(t);if(!e)return{needed:!1,count:0};const r=JSON.parse(e);return{needed:Array.isArray(r)&&r.length>0,count:Array.isArray(r)?r.length:0}}catch{return{needed:!1,count:0}}}return{getAll:m,getActive:g,getSettled:b,getById:L,create:S,update:y,remove:P,clearAll:D,getByLeague:$,getByDate:v,getByDateRange:A,getToday:k,updateStatus:C,markWon:E,markLost:x,markPush:N,getSummary:I,migrateFromLocalStorage:T,checkMigrationNeeded:a,invalidateCache:f}}();typeof module<"u"&&module.exports&&(module.exports=PicksService),window.PicksService=PicksService,function(){"use strict";typeof window.tableState>"u"&&(window.tableState={filters:{date:{start:null,end:null,selectedDates:null,selectedTimes:null,selectedBooks:null},matchup:{league:"",selectedLeagues:null,selectedTeams:null,ticketType:"all"},pick:{betType:"",subtype:"",segment:"",selectedSegments:null},risk:{min:null,max:null,selectedRiskRanges:[],selectedWinRanges:[]},status:[]},sort:{column:null,direction:"asc"},expandedParlayIds:[]});const p={createDateFilterState(){return{start:null,end:null,selectedDates:null,selectedTimes:null,selectedBooks:null}},createMatchupFilterState(){return{league:"",selectedLeagues:null,selectedTeams:null,ticketType:"all"}},createRiskFilterState(){return{min:null,max:null,selectedRiskRanges:[],selectedWinRanges:[]}},createPickFilterState(){return{betType:"",subtype:"",segment:"",selectedSegments:null}},ensureDateFilterShape(){const s=window.tableState;if(!s.filters.date||typeof s.filters.date!="object"){s.filters.date=this.createDateFilterState();return}const n=s.filters.date;"start"in n||(n.start=null),"end"in n||(n.end=null),"selectedDates"in n||(n.selectedDates=null),"selectedTimes"in n||(n.selectedTimes=null),"selectedBooks"in n||(n.selectedBooks=null)},ensureMatchupFilterShape(){const s=window.tableState;if(!s.filters.matchup||typeof s.filters.matchup!="object"){s.filters.matchup=this.createMatchupFilterState();return}const n=s.filters.matchup;"ticketType"in n||(n.ticketType="all"),"selectedTeams"in n||(n.selectedTeams=null),"league"in n||(n.league="")},ensureRiskFilterShape(){const s=window.tableState;if(!s.filters.risk||typeof s.filters.risk!="object"){s.filters.risk=this.createRiskFilterState();return}const n=s.filters.risk;"min"in n||(n.min=null),"max"in n||(n.max=null),Array.isArray(n.selectedRiskRanges)||(n.selectedRiskRanges=[]),Array.isArray(n.selectedWinRanges)||(n.selectedWinRanges=[])},ensurePickFilterShape(){const s=window.tableState;s.filters.pick||(s.filters.pick=this.createPickFilterState())},ensureAllFilterShapes(){this.ensureDateFilterShape(),this.ensureMatchupFilterShape(),this.ensureRiskFilterShape(),this.ensurePickFilterShape()}},d={getState(){return window.tableState},getFilter(s){return window.tableState.filters[s]},updateFilter(s,n){if(!window.tableState.filters[s]){console.warn(`Filter type ${s} does not exist`);return}Object.assign(window.tableState.filters[s],n)},resetFilter(s){switch(s){case"date":window.tableState.filters.date=p.createDateFilterState();break;case"matchup":window.tableState.filters.matchup=p.createMatchupFilterState();break;case"pick":window.tableState.filters.pick=p.createPickFilterState();break;case"risk":window.tableState.filters.risk=p.createRiskFilterState();break;case"status":window.tableState.filters.status=[];break;case"league":window.tableState.filters.matchup.league="",window.tableState.filters.matchup.selectedLeagues=null;break;case"segment":window.tableState.filters.pick.segment="",window.tableState.filters.pick.selectedSegments=null;break;default:console.warn(`Unknown filter type: ${s}`)}},resetAllFilters(){window.tableState.filters={date:p.createDateFilterState(),matchup:p.createMatchupFilterState(),pick:p.createPickFilterState(),risk:p.createRiskFilterState(),status:[]}},getExpandedParlayIds(){return Array.isArray(window.tableState.expandedParlayIds)||(window.tableState.expandedParlayIds=[]),window.tableState.expandedParlayIds},setParlayExpanded(s,n){if(!s)return;Array.isArray(window.tableState.expandedParlayIds)||(window.tableState.expandedParlayIds=[]);const h=window.tableState.expandedParlayIds.indexOf(s);n&&h===-1?window.tableState.expandedParlayIds.push(s):!n&&h!==-1&&window.tableState.expandedParlayIds.splice(h,1)},isParlayExpanded(s){return!s||!Array.isArray(window.tableState.expandedParlayIds)?!1:window.tableState.expandedParlayIds.includes(s)},toggleParlayExpanded(s){const n=this.isParlayExpanded(s);return this.setParlayExpanded(s,!n),!n},resetExpansionState(){window.tableState.expandedParlayIds=[]},getSortState(){return window.tableState.sort},updateSort(s,n){window.tableState.sort={column:s,direction:n||"asc"}},resetSort(){window.tableState.sort={column:null,direction:"asc"}},hasActiveFilters(){const s=window.tableState.filters;return!!(s.date.selectedDates||s.date.selectedTimes||s.date.selectedBooks||s.date.start||s.date.end||s.matchup.league||s.matchup.selectedLeagues||s.matchup.selectedTeams||s.matchup.ticketType!=="all"||s.pick.betType||s.pick.subtype||s.pick.segment||s.pick.selectedSegments||s.risk.min!==null||s.risk.max!==null||s.risk.selectedRiskRanges.length>0||s.risk.selectedWinRanges.length>0||s.status.length>0)},getActiveFilterCount(){let s=0;const n=window.tableState.filters;return n.date.selectedDates&&s++,n.date.selectedTimes&&s++,n.date.selectedBooks&&s++,(n.matchup.league||n.matchup.selectedLeagues)&&s++,n.matchup.selectedTeams&&s++,(n.pick.betType||n.pick.subtype)&&s++,(n.pick.segment||n.pick.selectedSegments)&&s++,n.risk.selectedRiskRanges.length>0&&s++,n.risk.selectedWinRanges.length>0&&s++,n.status.length>0&&s++,s},init(){p.ensureAllFilterShapes(),Array.isArray(window.tableState.expandedParlayIds)||(window.tableState.expandedParlayIds=[])}};window.PicksStateManager={...d,validators:p,state:window.tableState},d.init()}(),function(){"use strict";const p="gbsv_weekly_lineup_picks",d={activePicks:[],lastFetchedAt:null,isFetching:!1},s={tbody:()=>document.getElementById("picks-tbody"),lastRefreshed:()=>document.querySelector("#ft-last-refreshed .sync-time")},n=()=>new Date().toISOString(),h=a=>{if(!a)return"";const t=new Date(a);if(Number.isNaN(t.getTime()))return String(a);const e=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}/${r}`},c=a=>(a??"").toString(),u=a=>c(a).trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,40),f=a=>{const t=c(a).toUpperCase();return t==="NCAAM"||t==="NCAAB"?"NCAAB":t||"NBA"},m=a=>{const t=f(a.sport||a.league),e=(a.gameDate||a.date||"").toString().slice(0,10),r=u(a.awayTeam),i=u(a.homeTeam),o=u(a.pickType),l=u(a.segment),w=u(a.pickDirection||a.pickTeam||a.pick||""),R=u(a.line),F=`${t}-${e}-${r}-at-${i}-${o}-${l}-${w}-${R}`;return F.length<=255?F:F.slice(0,255)},g=(a,t="info")=>{if(window.showNotification){window.showNotification(a,t);return}try{const e=document.createElement("div");e.textContent=a,e.style.cssText="position:fixed;top:20px;right:20px;z-index:99999;padding:10px 14px;border-radius:10px;background:rgba(6,28,20,0.95);color:#e8f0f2;border:1px solid rgba(60,255,181,0.35);",document.body.appendChild(e),setTimeout(()=>e.remove(),2500)}catch{}},b=a=>{const t=s.lastRefreshed();if(!t)return;const e=new Date(a);if(Number.isNaN(e.getTime())){t.textContent="-";return}t.textContent=e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},L=a=>{const t=f(a);return t==="NBA"?{src:"assets/nba-logo.png",alt:"NBA"}:t==="NCAAB"?{src:"assets/ncaam-logo.png",alt:"NCAAM"}:t==="NFL"?{src:"assets/nfl-logo.png",alt:"NFL"}:t==="NCAAF"?{src:"assets/ncaaf-logo.png",alt:"NCAAF"}:{src:"",alt:t}},$=a=>{const t=Math.max(0,Math.min(5,parseInt(a,10)||0));return t<=0?"":"\u{1F525}".repeat(t)},v=a=>{const t=c(a.pickType||"").toLowerCase(),e=c(a.line);if(t==="total"){const r=c(a.pickDirection).toUpperCase();return`${r.includes("UNDER")?"Under":r.includes("OVER")?"Over":r} ${e}`.trim()}return t==="moneyline"||t==="ml"?`${c(a.pickTeam)} ML`.trim():`${c(a.pickTeam)} ${e}`.trim()},A=a=>{const t=s.tbody();t&&(t.innerHTML=`
      <tr class="empty-state-row">
        <td colspan="9" class="empty-state-cell">
          <div class="empty-state">
            <span class="empty-icon">\u{1F4CA}</span>
            <span class="empty-message">${c(a||"No picks")}</span>
          </div>
        </td>
      </tr>
    `)},k=a=>{const t=s.tbody();if(t){if(!Array.isArray(a)||a.length===0){A("No picks fetched yet. Click Fetch to load picks.");return}t.innerHTML="";for(const e of a){const r=f(e.sport||e.league),i=L(r),o=typeof e.edge=="number"?e.edge:parseFloat(String(e.edge||"").replace("%",""))||0,l=e.locked===!0,w=document.createElement("tr");w.className="pick-row",w.setAttribute("data-row-id",e.id),w.setAttribute("data-pick-id",e.id),w.setAttribute("data-league",r);const R=e.gameDate||e.date,F=h(R),_=c(e.odds||"-110"),M=c(e.segment||"FG"),B=v(e);w.innerHTML=`
        <td class="col-datetime">
          <div class="datetime-cell">
            <div class="cell-date">${c(F)}</div>
            <div class="cell-time">${c(e.time||e.gameTime||"")}</div>
            <div class="cell-book">${c(e.sportsbook||e.book||e.source||"Model")}</div>
          </div>
        </td>
        <td class="center col-league">
          <div class="league-cell">
            ${i.src?`<img src="${i.src}" class="league-logo" alt="${i.alt}" loading="lazy" />`:c(i.alt)}
          </div>
        </td>
        <td class="col-matchup">
          <div class="matchup-cell matchup-inline">
            <span class="team-line"><span class="team-name-full">${c(e.awayTeam)}</span></span>
            <span class="vs-divider">@</span>
            <span class="team-line"><span class="team-name-full">${c(e.homeTeam)}</span></span>
          </div>
        </td>
        <td class="center col-segment">
          <span class="segment-pill" data-segment="${u(M)}">${c(M)}</span>
        </td>
        <td class="col-pick">
          <div class="pick-inline">
            <span class="pick-team">${c(B)}</span>
            <span class="pick-odds">(${c(_)})</span>
          </div>
        </td>
        <td class="center col-edge">
          <span class="edge-badge">${o?`${o.toFixed(1)}%`:"-"}</span>
        </td>
        <td class="center col-fire">
          <span class="fire-cell" title="Fire rating">${$(e.fire)}</span>
        </td>
        <td class="center col-track">
          <button
            class="tracker-btn"
            type="button"
            data-pick-id="${e.id}"
            aria-pressed="${l?"true":"false"}"
            title="${l?"Locked in (on Dashboard)":"Not locked"}"
          >${l?"\u{1F512}":"\uFF0B"}</button>
        </td>
      `,t.appendChild(w)}window.Accessibility?.init&&window.Accessibility.init()}},S=a=>{try{localStorage.setItem(p,JSON.stringify({picks:a,fetchedAt:n()}))}catch{}},y=a=>{const t=f(a.sport||a.league),e=(a.gameDate||a.date||n()).toString().slice(0,10);return{id:a.id||m(a),sport:t,league:t,awayTeam:c(a.awayTeam),homeTeam:c(a.homeTeam),pickType:c(a.pickType||"spread").toLowerCase(),pickDirection:c(a.pickDirection||""),pickTeam:c(a.pickTeam||""),line:c(a.line||""),odds:c(a.odds||""),edge:typeof a.edge=="number"?a.edge:parseFloat(String(a.edge||"").replace("%",""))||0,segment:c(a.segment||"FG"),sportsbook:c(a.sportsbook||a.book||"Model"),gameDate:e,gameTime:c(a.time||a.gameTime||""),status:c(a.status||"pending").toLowerCase(),locked:a.locked===!0,lockedAt:a.locked===!0?a.lockedAt||n():null,source:"weekly-lineup",model:c(a.modelStamp||a.model||""),confidence:a.fire??a.confidence??null,notes:c(a.rationale||a.notes||"")}},C=async a=>{if(!window.PicksService?.create){g("PicksService not available (Cosmos sync disabled)","warning");return}if(!Array.isArray(a)||a.length===0)return;const t=a.map(e=>{const r=y({...e,locked:!1,lockedAt:null});return r.id=r.id||m(r),r});try{await window.PicksService.create(t),g(`Saved ${t.length} picks to Dashboard (unlocked)`,"success")}catch(e){g(`Failed to save picks: ${e.message||e}`,"error")}},E=async(a,t)=>{const e=d.activePicks.find(r=>r.id===a);if(e){if(!window.PicksService?.update){g("PicksService not available (cannot lock/unlock)","error");return}try{const r=t?{locked:!0,lockedAt:n()}:{locked:!1,lockedAt:null};await window.PicksService.update(a,r),e.locked=t,e.lockedAt=r.lockedAt,k(d.activePicks),S(d.activePicks),g(t?"Locked in \u2014 now on Dashboard":"Unlocked \u2014 removed from Dashboard","success")}catch(r){g(`Lock update failed: ${r.message||r}`,"error")}}},x=()=>{const a=s.tbody();a&&a.addEventListener("click",t=>{const e=t.target.closest(".tracker-btn");if(!e)return;t.preventDefault(),t.stopPropagation();const r=e.getAttribute("data-pick-id");if(!r)return;const i=e.getAttribute("aria-pressed")==="true";E(r,!i)})},N=()=>"today",P=async a=>{if(!d.isFetching){if(!window.UnifiedPicksFetcher?.fetchPicks){g("Model fetchers not loaded","error");return}d.isFetching=!0;try{const t=N(),e=await window.UnifiedPicksFetcher.fetchPicks(a,t,{skipCache:!0}),i=(Array.isArray(e?.picks)?e.picks:[]).map(o=>{const l={...o};return l.sport=f(l.sport||l.league),l.gameDate=(l.gameDate||l.date||n()).toString().slice(0,10),l.id=l.id||m(l),l.locked=l.locked===!0,l});if(i.sort((o,l)=>(l.edge||0)-(o.edge||0)),d.activePicks=i,d.lastFetchedAt=n(),k(i),b(d.lastFetchedAt),S(i),await C(i),e?.errors?.length){const o=e.errors.map(l=>l.league).join(", ");g(`Some leagues unavailable: ${o}`,"warning")}}catch(t){g(`Fetch failed: ${t.message||t}`,"error"),A("Unable to fetch picks. Please try again.")}finally{d.isFetching=!1}}},D=()=>{const a=document.querySelector(".filter-toolbar");a&&a.addEventListener("click",t=>{const e=t.target.closest("button[data-fetch]");if(!e)return;t.preventDefault();const r=c(e.getAttribute("data-fetch")).toLowerCase();if(r){if(r==="all"){P("all");return}if(r==="ncaab"||r==="ncaam"){P("ncaam");return}P(r)}})},I=()=>{try{const a=localStorage.getItem(p);if(!a)return;const t=JSON.parse(a);if(!Array.isArray(t?.picks))return;d.activePicks=t.picks,d.lastFetchedAt=t.fetchedAt||null,k(d.activePicks),d.lastFetchedAt&&b(d.lastFetchedAt)}catch{}};window.WeeklyLineup={getActivePicks(){return d.activePicks||[]},populateTable(a){d.activePicks=Array.isArray(a)?a:[],k(d.activePicks),S(d.activePicks)},showNotification(a,t){g(a,t)},showEmptyState(a){A(a)}};const T=()=>{I(),D(),x(),d.lastFetchedAt&&b(d.lastFetchedAt)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",T):T()}();
//# sourceMappingURL=weekly-lineup.min.js.map
